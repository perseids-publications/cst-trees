/*
 * Arethusa - a backend-independent client-side annotation framework
 * http://github.com/alpheios-project/arethusa
 *
 * Version 0.2.5
 * built from branch master
 * at 449ee3e5eb26fba7ede57b24be71aac565de0667
 * on 2017-06-07T14:58:53.301Z
 *
 * Published under the MIT license
 */

"use strict";angular.module("arethusa.contextMenu",[]),angular.module("arethusa.contextMenu").directive("arethusaContextMenu",[function(){return{restrict:"AE",scope:{token:"=tokenObj",plugins:"="},link:function(a,b,c){},templateUrl:"js/arethusa.context_menu/templates/arethusa_context_menu.html"}}]),angular.module("arethusa.contextMenu").directive("arethusaContextMenus",[function(){return{restrict:"A",scope:{tokens:"=",plugins:"="},link:function(a,b,c){a.fullId=function(a){return a.sentenceId+a.id}},template:'        <arethusa-context-menu          ng-repeat="(id, token) in tokens track by id"          plugins="plugins"          token-obj="token">        </arethusa-context-menu>      '}}]),angular.module("arethusa.contextMenu").factory("menuElement",function(){return{element:null}}).directive("contextMenu",["$document","$parse","menuElement","keyCapture",function(a,b,c,d){return{restrict:"A",scope:{menuObj:"=",menuTrigger:"@",menuPosition:"@"},link:function(e,f,g){function h(a,b){console.log(b);var c=b.offset();console.log(c);var d,f;"bottom"===e.menuPosition&&(f=c.top+b.outerHeight(),d=c.left),"right"===e.menuPosition&&(f=c.top,d=c.left+b.outerWidth()),a.css("right","40px"),a.css("top","150px")}function i(a,b,d){b.addClass("menu-open"),b.css("display","inline-block"),h(b,d),c.lastTarget=a.target,e.menuObj&&(e.menuObj.status.contextMenuOpen=!0),p=!0}function j(a){a.removeClass("menu-open"),a.css("display","none"),c.lastTarget=void 0,e.menuObj&&(e.menuObj.status.contextMenuOpen=!1),p=!1}function k(){e.$apply(function(){j(c.element)})}function l(a){return a.target===c.lastTarget&&a.button===o()}function m(a){if(p){if(n(a.target))return;if(l(a))return;k()}}function n(a){var b=angular.element(a),d=c.element;return b.parents("#"+d.attr("id")).length}function o(){var a={rightclick:2,click:1};return a[e.menuTrigger]}var p=!1,q=b(g.contextMenu),r=function(){return"rightclick"==e.menuTrigger?"contextmenu":"click"==e.menuTrigger?"click":void 0}();f.bind(r,function(a){c.element&&j(c.element),c.element=angular.element(document.getElementById(g.menuId)),a.preventDefault(),a.stopPropagation(),e.$apply(function(){q(e,{$event:a}),i(a,c.element,f)})}),a.on("click",m);var s=d.onKeyPressed("esc",function(){p&&(k(),d.stopPropagation())},1e3);e.$on("$destroy",function(){a.off("click",m),s()})}}}]),angular.module("arethusa.contextMenu").directive("pluginContextMenu",function(){return{restrict:"E",scope:!0,replace:!0,template:'      <div id="{{ plugin.name }}-context-menu"        ng-include="plugin.contextMenuTemplate">      </div>    '}}),angular.module("arethusa.contextMenu").run(["$templateCache",function(a){a.put("js/arethusa.context_menu/templates/arethusa_context_menu.html",'<div id="tcm{{ token.id }}" class="token-context-menu">\n  <div ng-if="token.status.contextMenuOpen">\n    <div ng-repeat="plugin in plugins">\n      <plugin-context-menu class="menu-element"></plugin-context-menu>\n    </div>\n  </div>\n</div>\n')}]);
//# sourceMappingURL=arethusa.context_menu.min.map